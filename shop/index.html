<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shop • Raees Pharmacy</title>
  <meta name="description" content="Shop OTC essentials at Raees Pharmacy. Call to order for pickup or free local delivery." />
  <style>
    :root{
      --green:#16a34a; --ink:#1f2937; --muted:#6b7280; --soft:#f8fafc; --border:#e5e7eb;
    }
    *{box-sizing:border-box}
    html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--ink);background:#fff}
    a{color:var(--green);text-decoration:none}
    header{background:#0ea5e9;color:#fff}
    .wrap{max-width:1160px;margin:0 auto;padding:16px 20px}
    .brand{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .brand h1{font-size:18px;margin:0}
    .call{background:#16a34a;color:#fff;padding:8px 12px;border-radius:8px;font-weight:700}
    main{background:var(--soft);min-height:70vh;padding:28px 0}
    h2{margin:0 0 6px}
    .sub{color:var(--muted);margin:0 0 18px}
    .filters{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 18px}
    .btn{border:1px solid var(--border);background:#fff;padding:8px 12px;border-radius:999px;cursor:pointer}
    .btn.active{background:#16a34a;color:#fff;border-color:#16a34a}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .card{background:#fff;border:1px solid var(--border);border-radius:14px;padding:14px;box-shadow:0 8px 18px rgba(2,6,23,.06)}
    .img{width:100%;height:160px;border-radius:10px;background:#eef2f7 display:block;object-fit:contain}
    .price-line{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
    .cta{background:#16a34a;color:#fff;border:none;border-radius:10px;padding:10px 12px;font-weight:700;cursor:pointer}
    footer{border-top:1px solid var(--border);padding:14px 0;color:var(--muted)}
    @media (max-width: 960px){ .grid{grid-template-columns:1fr 1fr} }
    @media (max-width: 640px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <header>
    <div class="wrap brand">
      <h1>Raees Pharmacy — Shop</h1>
      <div style="display:flex;gap:10px;align-items:center">
        <a href="/" style="color:#fff">Home</a>
        <a class="call" href="tel:+17188565998">Call 718-856-5998</a>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <h2>OTC Essentials</h2>
      <p class="sub">Browse OTC items. To order, call us for pickup or free local delivery (zone-based).</p>

      <!-- Category buttons (match your CSV 'category' values) -->
      <div class="filters" id="filters">
        <button class="btn active" data-cat="all">All</button>
        <button class="btn" data-cat="pain">Pain Relief</button>
        <button class="btn" data-cat="allergy">Allergy</button>
        <button class="btn" data-cat="vitamins">Vitamins</button>
        <button class="btn" data-cat="firstaid">First Aid</button>
        <button class="btn" data-cat="coldflu">Cold &amp; Flu</button>
      </div>

      <div id="grid" class="grid" aria-live="polite"></div>

      <p class="sub" id="note" style="margin-top:14px"></p>
    </div>
  </main>

  <footer>
    <div class="wrap">© <span id="y"></span> Raees Pharmacy • 750 Flatbush Ave, Brooklyn, NY 11226</div>
  </footer>

  <script>
    // year
    document.getElementById('y').textContent = new Date().getFullYear();

    // Where the CSV lives (tries products.csv.csv, then products.csv)
    const CSV_CANDIDATES = ["/products.csv.csv", "/products.csv"];

    // Tiny CSV parser (supports quoted commas)
    function parseCSV(csv){
      const lines = csv.split(/\r?\n/).filter(Boolean);
      if(!lines.length) return [];
      const headers = lines.shift().split(",").map(h=>h.trim());
      return lines.map(line=>{
        const out=[], q='"'; let cur='', inQ=false;
        for(let i=0;i<line.length;i++){
          const ch=line[i], nx=line[i+1];
          if(ch===q && nx===q){cur+=q; i++; continue;}
          if(ch===q){inQ=!inQ; continue;}
          if(ch===',' && !inQ){out.push(cur); cur=''; continue;}
          cur+=ch;
        }
        out.push(cur);
        const obj={};
        headers.forEach((h,i)=>obj[h]= (out[i]||'').trim());
        return obj;
      });
    }

    function money(v){ const n = Number(v); return isFinite(n) ? "$"+n.toFixed(2) : ""; }

    function cardHTML(p){
      const img = p.image || "https://via.placeholder.com/600x400?text=Product";
      const name = p.name || "";
      const price = money(p.price);
      const desc = p.desc || "";
      const sku  = p.sku  || "";
      return `
        <div class="card product" data-cat="${(p.category||'other').toLowerCase()}">
          <img class="img" src="${img}" alt="${name}">
          <h3 style="margin:10px 0 6px;font-size:17px">${name}</h3>
          ${desc?`<p class="sub" style="margin:0 0 8px">${desc}</p>`:""}
          ${sku? `<p class="sub" style="margin:0;color:#64748b">SKU: ${sku}</p>`:""}
          <div class="price-line">
            <strong>${price}</strong>
            <a class="cta" href="tel:+17188565998">Call to order</a>
          </div>
        </div>`;
    }

    function render(products){
      const grid = document.getElementById('grid');
      grid.innerHTML = products
        .filter(p => !(p.qty && Number(p.qty) <= 0)) // hide OOS; remove if you want to show all
        .map(cardHTML).join('');

      // Filter behavior
      document.querySelectorAll('#filters .btn').forEach(btn=>{
        btn.onclick = ()=>{
          document.querySelectorAll('#filters .btn').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          const cat = btn.dataset.cat;
          document.querySelectorAll('.product').forEach(el=>{
            el.style.display = (cat==='all'|| el.dataset.cat===cat) ? '' : 'none';
          });
        };
      });

      document.getElementById('note').textContent =
        'Tip: Categories come from the "category" column in your CSV. Edit it anytime.';
    }

    // Try multiple CSV paths
    (async ()=>{
      let csvText=null, used=null;
      for(const url of CSV_CANDIDATES){
        try{
          const r = await fetch(url, {cache:"no-store"});
          if(r.ok){ csvText = await r.text(); used = url; break; }
        }catch(e){}
      }
      if(!csvText){
        document.getElementById('grid').innerHTML =
          '<div class="card"><p>Could not load products. Ensure products.csv is in the repo root.</p></div>';
        return;
      }
      const rows = parseCSV(csvText);
      if(!rows.length){
        document.getElementById('grid').innerHTML =
          '<div class="card"><p>No products found in CSV.</p></div>';
        return;
      }
      render(rows);
      console.log("Loaded products from:", used, "Count:", rows.length);
    })();
  </script>
</body>
</html>
